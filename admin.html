<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WhatsApp Lottery - Admin Dashboard">
    <title>WhatsApp Lottery - ניהול</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/admin.css">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 3D Visual Background -->
    <div class="bg-visuals">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <!-- Top Right Logo -->
    <div class="brand-container">
        <img src="logo.png" alt="Logo" class="main-logo">
    </div>

    <div id="app" class="app-content">
        
        <!-- State 1: Logged Out - Login Screen -->
        <div id="login-screen" class="login-screen">
            <div class="card-3d text-center" style="max-width: 500px; margin: 0 auto; padding: 60px;">
                <h1 style="margin-bottom: 20px;">ניהול הגרלות</h1>
                <p style="margin-bottom: 40px;">התחברו למערכת כדי לנהל את הקמפיינים שלכם</p>
                
                <button id="btn-google-login" class="btn-wow" style="width: 100%; background: #fff; color: #000; border: 2px solid #eee; box-shadow: none;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width: 24px;">
                    התחברות עם Google
                </button>
            </div>
        </div>

        <!-- State 2 & 3: Logged In - Dashboard -->
        <div id="dashboard" class="dashboard hidden" style="display: grid; grid-template-columns: 280px 1fr; gap: 40px;">
            <!-- Navigation -->
            <nav class="card-3d" style="padding: 30px; height: fit-content; position: sticky; top: 120px;">
                <ul style="list-style: none;">
                    <li class="nav-item active" data-view="campaigns" style="margin-bottom: 10px; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-weight: 700;">
                        <span>🎰 הקמפיינים שלי</span>
                    </li>
                    <li class="nav-item" data-view="create" style="padding: 15px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-weight: 700;">
                        <span>➕ יצירת הגרלה</span>
                    </li>
                </ul>
                
                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <img id="user-avatar" src="" style="width: 45px; height: 45px; border-radius: 50%;">
                        <div style="overflow: hidden;">
                            <p id="user-name" style="font-weight: 800; font-size: 0.9rem; white-space: nowrap; text-overflow: ellipsis; color: #000;"></p>
                        </div>
                    </div>
                    <button id="btn-logout" class="btn-wow" style="width: 100%; height: 45px; font-size: 0.8rem; background: #fee2e2; color: #ef4444; box-shadow: none;">התנתקות</button>
                </div>
            </nav>

            <!-- Main Content -->
            <main>
                <!-- View: List -->
                <section id="view-campaigns">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                        <h2>🎰 הקמפיינים שלי</h2>
                        <button id="btn-new-campaign" class="btn-wow">➕ הגרלה חדשה</button>
                    </div>
                    
                    <div id="campaigns-empty" class="card-3d text-center" style="padding: 80px;">
                        <span style="font-size: 4rem;">🎲</span>
                        <h3 style="margin: 20px 0;">אין עדיין הגרלות</h3>
                        <p style="margin-bottom: 30px;">צרו את ההגרלה הראשונה שלכם עכשיו!</p>
                        <button id="btn-create-first" class="btn-wow">יצירת הגרלה ראשונה</button>
                    </div>

                    <div id="campaigns-list" class="hidden" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;"></div>
                </section>

                <!-- View: Create -->
                <section id="view-create" class="hidden">
                    <div class="card-3d">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                            <h2 id="create-view-title">➕ יצירת הגרלה</h2>
                            <button id="btn-save-campaign" class="btn-wow">🚀 פרסום עכשיו</button>
                        </div>

                        <form id="campaign-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">כותרת ההגרלה *</label>
                                    <input type="text" name="title" required>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">תיאור</label>
                                    <textarea name="description" rows="4"></textarea>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">תאריך סיום *</label>
                                    <input type="datetime-local" name="endDate" required>
                                </div>
                            </div>
                            <div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">שם איש קשר (לשמירה) *</label>
                                    <input type="text" name="contactVcardName" required>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">מספר טלפון (9725...) *</label>
                                    <input type="tel" name="contactPhoneNumber" required>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 8px; font-weight: 700;">טקסט שיתוף</label>
                                    <textarea name="whatsappShareText" rows="3"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- View: Details -->
                <section id="view-details" class="hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
                        <h2 id="details-title">פרטי הגרלה</h2>
                        <div style="display: flex; gap: 10px;">
                            <button id="btn-edit-campaign" class="btn-wow" style="background: #fff; color: #000; border: 2px solid #000; box-shadow: none;">עריכה</button>
                            <button id="btn-delete-campaign" class="btn-wow" style="background: #fee2e2; color: #ef4444; box-shadow: none;">מחיקה</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 40px;">
                        <div class="card-3d text-center" style="padding: 25px;">
                            <span style="font-weight: 700; color: var(--text-light);">צפיות</span>
                            <div id="stat-views" style="font-size: 2.5rem; font-weight: 900; color: #000;">0</div>
                        </div>
                        <div class="card-3d text-center" style="padding: 25px;">
                            <span style="font-weight: 700; color: var(--text-light);">נרשמים</span>
                            <div id="stat-leads" style="font-size: 2.5rem; font-weight: 900; color: #000;">0</div>
                        </div>
                        <div class="card-3d text-center" style="padding: 25px;">
                            <span style="font-weight: 700; color: var(--text-light);">כרטיסים</span>
                            <div id="stat-tickets" style="font-size: 2.5rem; font-weight: 900; color: #000;">0</div>
                        </div>
                    </div>

                    <div class="card-3d" style="margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px;">🎲 הגרלת זוכה</h3>
                        <div style="display: flex; gap: 20px;">
                            <input type="number" id="winner-count" value="1" min="1" style="width: 100px;">
                            <button id="btn-select-winner" class="btn-wow" style="flex: 1;">🎰 הגרל עכשיו!</button>
                        </div>
                        <div id="winner-display" class="hidden" style="margin-top: 30px; padding: 25px; background: #f0fdf4; border-radius: 20px; border: 2px solid #22c55e;">
                            <h4 style="color: #16a34a; margin-bottom: 10px;">🏆 הזוכים:</h4>
                            <div id="winner-list"></div>
                        </div>
                    </div>

                    <div class="card-3d">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h3>👥 נרשמים</h3>
                            <button id="btn-export-leads" class="btn-wow" style="height: 45px; font-size: 0.9rem;">CSV ייצוא</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-spacing: 0 10px; border-collapse: separate;">
                                <thead>
                                    <tr style="text-align: right; color: var(--text-light); font-size: 0.8rem;">
                                        <th style="padding: 10px;">שם</th>
                                        <th>טלפון</th>
                                        <th>כרטיסים</th>
                                        <th>פעולות</th>
                                    </tr>
                                </thead>
                                <tbody id="leads-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- VCF Guide Modal -->
    <div id="vcf-guide-modal" class="modal hidden">
        <div class="modal-content guide-modal">
            <button class="modal-close" id="close-vcf-guide">&times;</button>
            
            <div class="guide-header">
                <h2>📱 איך לייבא אנשי קשר לטלפון?</h2>
                <p>מדריך פשוט צעד אחר צעד</p>
            </div>
            
            <div class="guide-content">
                <div class="guide-tabs">
                    <button class="guide-tab active" data-tab="iphone">🍎 iPhone</button>
                    <button class="guide-tab" data-tab="android">🤖 Android</button>
                    <button class="guide-tab" data-tab="computer">💻 מחשב</button>
                </div>
                
                <!-- iPhone Guide -->
                <div class="guide-panel active" id="guide-iphone">
                    <ol class="guide-steps">
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>הורד את הקובץ</h4>
                                <p>לחץ על כפתור "📱 שמור אנשי קשר בטלפון" - הקובץ יורד אוטומטית</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>פתח את הקובץ</h4>
                                <p>לחץ על ההתראה או עבור לאפליקציית "קבצים" ומצא את הקובץ בתיקיית "הורדות"</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>בחר "פתח באנשי קשר"</h4>
                                <p>iPhone יזהה אוטומטית שזה קובץ אנשי קשר ויציע לייבא</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>אשר את הייבוא</h4>
                                <p>לחץ "הוסף את כל X אנשי הקשר" - וסיימת! 🎉</p>
                            </div>
                        </li>
                    </ol>
                    <div class="guide-tip">
                        <strong>💡 טיפ:</strong> אם הקובץ נפתח בספארי, לחץ על כפתור השיתוף (ריבוע עם חץ) ובחר "אנשי קשר"
                    </div>
                </div>
                
                <!-- Android Guide -->
                <div class="guide-panel" id="guide-android">
                    <ol class="guide-steps">
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>הורד את הקובץ</h4>
                                <p>לחץ על כפתור "📱 שמור אנשי קשר בטלפון" - הקובץ יורד אוטומטית</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>פתח את הקובץ</h4>
                                <p>לחץ על ההתראה או עבור לאפליקציית "הקבצים שלי" / "Downloads"</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>בחר את אפליקציית אנשי הקשר</h4>
                                <p>Android יציע לפתוח את הקובץ עם "אנשי קשר" - בחר בה</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>אשר את הייבוא</h4>
                                <p>בחר לאן לשמור (חשבון Google מומלץ) ולחץ "ייבוא" 🎉</p>
                            </div>
                        </li>
                    </ol>
                    <div class="guide-tip">
                        <strong>💡 טיפ:</strong> באנדרואיד אפשר גם לפתוח את אפליקציית אנשי הקשר, ללכת להגדרות ← ייבוא/ייצוא ← ייבוא מקובץ
                    </div>
                </div>
                
                <!-- Computer Guide -->
                <div class="guide-panel" id="guide-computer">
                    <ol class="guide-steps">
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>הורד את הקובץ</h4>
                                <p>לחץ על כפתור "📱 שמור אנשי קשר בטלפון" - הקובץ יורד לתיקיית ההורדות</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>פתח את Google Contacts</h4>
                                <p>גש ל-<a href="https://contacts.google.com" target="_blank">contacts.google.com</a> והתחבר לחשבון Google</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>לחץ על "ייבוא"</h4>
                                <p>בתפריט השמאלי לחץ "ייבוא" ← "בחר קובץ" ← בחר את קובץ ה-VCF שהורדת</p>
                            </div>
                        </li>
                        <li class="guide-step">
                            <div class="guide-step-content">
                                <h4>סנכרן לטלפון</h4>
                                <p>אנשי הקשר יסתנכרנו אוטומטית לטלפון שלך אם מחובר לאותו חשבון Google 🎉</p>
                            </div>
                        </li>
                    </ol>
                    <div class="guide-tip">
                        <strong>💡 טיפ למשתמשי Mac:</strong> אפשר גם ללחוץ פעמיים על קובץ ה-VCF - זה יפתח את אפליקציית אנשי הקשר ויציע לייבא
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/controllers/adminCtrl.js"></script>
</body>
</html>
