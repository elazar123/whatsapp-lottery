<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="×¦×¤×• ×‘×›×œ ×”×”×’×¨×œ×•×ª ×”×¤×ª×•×—×•×ª ×•×”×™×¨×©××• ×œ×–×›×•×ª ×‘×¤×¨×¡×™× ×©×•×•×™×!">
    <title>×”×’×¨×œ×•×ª ×¤×ª×•×—×•×ª | WhatsApp Lottery</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/campaign.css">
</head>
<body>
    <!-- 3D Visual Background -->
    <div class="bg-visuals">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <!-- Top Right Logo -->
    <div class="brand-container">
        <img src="logo.png" alt="Logo" class="main-logo">
    </div>

    <div id="app" class="app-content">
        <header style="text-align: center; margin-bottom: 80px;">
            <h1>ğŸŒ ×”×’×¨×œ×•×ª ×¤×ª×•×—×•×ª</h1>
            <p style="font-size: 1.5rem; margin-top: 15px;">××¦××• ×”×’×¨×œ×•×ª ×©×•×•×ª ×•×”×¦×˜×¨×¤×• ×¢×›×©×™×• ×‘×—×™× ×!</p>
        </header>

        <main>
            <div id="loading-lotteries" class="text-center" style="padding: 100px;">
                <div class="loader" style="margin: 0 auto 20px;"></div>
                <p>××—×¤×© ×”×’×¨×œ×•×ª...</p>
            </div>

            <div id="empty-lotteries" class="hidden text-center card-3d" style="padding: 80px;">
                <span style="font-size: 4rem;">ğŸ²</span>
                <h3 style="margin: 20px 0;">××™×Ÿ ×›×¨×’×¢ ×”×’×¨×œ×•×ª ×¤×¢×™×œ×•×ª</h3>
                <p>×—×–×¨×• ×‘×§×¨×•×‘ ×›×“×™ ×œ×¨××•×ª ×”×’×¨×œ×•×ª ×—×“×©×•×ª!</p>
            </div>

            <div id="lotteries-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; margin-bottom: 80px;">
                <!-- Lotteries will be loaded here -->
            </div>
        </main>

        <footer style="text-align: center; padding: 100px 0; opacity: 0.5;">
            <p>× ×‘× ×” ×¢×œ ×™×“×™ <strong>×¨×™×’×¨ ×”×¤×§×•×ª</strong></p>
        </footer>
    </div>

    <script type="module">
        import { getActiveCampaigns } from './js/services/db.js';
        import { initFirebase } from './js/config/firebase.js';

        async function init() {
            initFirebase();
            const listEl = document.getElementById('lotteries-list');
            const loadingEl = document.getElementById('loading-lotteries');
            const emptyEl = document.getElementById('empty-lotteries');

            try {
                const lotteries = await getActiveCampaigns();
                loadingEl.classList.add('hidden');

                if (lotteries.length === 0) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                listEl.innerHTML = lotteries.map(lottery => {
                    const endDate = lottery.endDate?.toDate ? lottery.endDate.toDate() : new Date(lottery.endDate);
                    const formattedDate = endDate.toLocaleDateString('he-IL');
                    
                    return `
                        <div class="card-3d" style="padding: 0; overflow: hidden; display: flex; flex-direction: column;">
                            <div style="height: 200px; background: #eee; position: relative; overflow: hidden;">
                                ${lottery.bannerUrl ? `<img src="${lottery.bannerUrl}" style="width: 100%; height: 100%; object-fit: cover;">` : '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 3rem;">ğŸ²</div>'}
                                <div style="position: absolute; top: 15px; right: 15px; background: var(--accent); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: 800; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">×¤×¢×™×œ</div>
                            </div>
                            <div style="padding: 25px; flex: 1; display: flex; flex-direction: column;">
                                <h3 style="font-size: 1.5rem; margin-bottom: 10px;">${lottery.title}</h3>
                                <p style="font-size: 0.95rem; color: var(--text-light); margin-bottom: 20px; flex: 1;">${lottery.description || '×œ×—×¦×• ×œ×”×¦×˜×¨×¤×•×ª ×œ×”×’×¨×œ×” ×•×”×’×“×œ×ª ×¡×™×›×•×™×™ ×”×–×›×™×™×”.'}</p>
                                <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px;">
                                    <span style="font-size: 0.85rem; font-weight: 700;">ğŸ“… ××¡×ª×™×™× ×‘: ${formattedDate}</span>
                                    <span style="font-size: 0.85rem; font-weight: 700;">ğŸ‘¥ ${lottery.leadsCount || 0} ××©×ª×ª×¤×™×</span>
                                </div>
                                <a href="index.html?c=${lottery.id}" class="btn-wow" style="width: 100%; height: 50px;">×”×¦×˜×¨×¤×•×ª ×¢×›×©×™×• â†</a>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading lotteries:', error);
                loadingEl.innerHTML = '<p class="text-error">××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×’×¨×œ×•×ª.</p>';
            }
        }

        init();
    </script>
</body>
</html>
