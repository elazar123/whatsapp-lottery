<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="×¦×¤×• ×‘×›×œ ×”×”×’×¨×œ×•×ª ×”×¤×ª×•×—×•×ª ×•×”×™×¨×©××• ×œ×–×›×•×ª ×‘×¤×¨×¡×™× ×©×•×•×™×!">
    <title>×”×’×¨×œ×•×ª ×¤×ª×•×—×•×ª | WhatsApp Lottery</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/campaign.css">
</head>
<body>
    <div class="hero-visual"></div>
    
    <nav class="navbar">
        <div class="navbar-brand">
            <img src="logo.png" alt="WhatsApp Lottery" class="navbar-logo">
        </div>
    </nav>

    <div id="app" class="main-container">
        <header class="home-header">
            <h1>ğŸŒ ×”×’×¨×œ×•×ª ×¤×ª×•×—×•×ª</h1>
            <p>××¦××• ×”×’×¨×œ×•×ª ×©×•×•×ª ×•×”×¦×˜×¨×¤×• ×¢×›×©×™×• ×‘×—×™× ×!</p>
        </header>

        <main>
            <div id="loading-lotteries" class="text-center" style="padding: 100px;">
                <div class="loader" style="margin: 0 auto 20px;"></div>
                <p>××—×¤×© ×”×’×¨×œ×•×ª...</p>
            </div>

            <div id="empty-lotteries" class="hidden text-center wow-card" style="padding: 60px;">
                <p>××™×Ÿ ×›×¨×’×¢ ×”×’×¨×œ×•×ª ×¤×¢×™×œ×•×ª. ×—×–×¨×• ×‘×§×¨×•×‘! ğŸ²</p>
            </div>

            <div id="lotteries-list" class="lotteries-grid">
                <!-- Lotteries will be loaded here -->
            </div>
        </main>

        <footer style="text-align: center; padding: 60px 0; opacity: 0.6;">
            <p>× ×‘× ×” ×¢×œ ×™×“×™ <strong>×¨×™×’×¨ ×”×¤×§×•×ª</strong> | 052-562-4350</p>
        </footer>
    </div>

    <script type="module">
        import { getActiveCampaigns } from './js/services/db.js';
        import { initFirebase } from './js/config/firebase.js';

        async function init() {
            initFirebase();
            const listEl = document.getElementById('lotteries-list');
            const loadingEl = document.getElementById('loading-lotteries');
            const emptyEl = document.getElementById('empty-lotteries');

            try {
                const lotteries = await getActiveCampaigns();
                loadingEl.classList.add('hidden');

                if (lotteries.length === 0) {
                    emptyEl.classList.remove('hidden');
                    return;
                }

                listEl.innerHTML = lotteries.map(lottery => {
                    const endDate = lottery.endDate?.toDate ? lottery.endDate.toDate() : new Date(lottery.endDate);
                    const formattedDate = endDate.toLocaleDateString('he-IL');
                    
                    return `
                        <div class="lottery-card">
                            <div class="lottery-image">
                                ${lottery.bannerUrl ? `<img src="${lottery.bannerUrl}" alt="${lottery.title}">` : '<div class="upload-placeholder"><span class="upload-icon">ğŸ²</span></div>'}
                                <span class="lottery-badge">×‘×§×¨×•×‘ × ×’××¨!</span>
                            </div>
                            <div class="lottery-info">
                                <h3>${lottery.title}</h3>
                                <p>${lottery.description || '×œ×—×¦×• ×œ×”×¦×˜×¨×¤×•×ª ×œ×”×’×¨×œ×”'}</p>
                                <div class="lottery-meta">
                                    <span class="lottery-date">ğŸ“… ××¡×ª×™×™× ×‘: ${formattedDate}</span>
                                    <span class="lottery-date">ğŸ‘¥ ${lottery.leadsCount || 0} ××©×ª×ª×¤×™×</span>
                                </div>
                                <a href="index.html?c=${lottery.id}" class="btn btn-primary btn-join">×× ×™ ×¨×•×¦×” ×œ×”×©×ª×ª×£! â†</a>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading lotteries:', error);
                loadingEl.innerHTML = '<p class="text-error">××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×’×¨×œ×•×ª.</p>';
            }
        }

        init();
    </script>
</body>
</html>
